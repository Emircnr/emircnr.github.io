<!DOCTYPE html>
<html lang="tr">
<head>
  <meta http-equiv="Content-Security-Policy"
content="
default-src 'self';
script-src 'self'
  https://www.gstatic.com
  https://www.googleapis.com
  https://unpkg.com
  https://cdnjs.cloudflare.com
  'unsafe-eval';
style-src 'self' 'unsafe-inline' https://unpkg.com https://fonts.googleapis.com;
img-src 'self' data: blob: https://*;
font-src https://fonts.gstatic.com;
connect-src 'self'
  https://*.firebaseio.com
  wss://*.firebaseio.com
  https://www.googleapis.com
  https://securetoken.googleapis.com
  https://identitytoolkit.googleapis.com;
frame-src https://accounts.google.com https://*.firebaseapp.com;
"/>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Global Conquest - Online</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />

  <!-- Icons & Animations -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <style>
    :root{
      --bg1:#0e0f12; --bg2:#151726; --glass:rgba(0,0,0,.45);
      --text:#eeeeee; --muted:#b9c0c7;
      --brand:#64ffda; --brand2:#00c9ff; --warn:#f39c12; --danger:#ff4b4b;
      --card:#0f1320; --line:#2a2f3b;
      --shadow:0 12px 28px rgba(0,0,0,.7);
      --radius:16px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:"Montserrat",sans-serif;
      color:var(--text);
      background: radial-gradient(circle at 20% 0%, #12151b 0%, #0b0c10 60%, #000 100%);
      overflow:hidden;
    }
    h1,h2,h3,h4{font-family:"Orbitron",sans-serif; letter-spacing:.5px; text-transform:uppercase}

    /* ---------- AUTH ---------- */
    #auth-container{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      background: linear-gradient(135deg,#120a2a 0%,#171433 50%,#151515 100%);
      z-index:9999;
    }
    .auth-box{
      width:min(440px,92vw);
      background:var(--glass); backdrop-filter: blur(8px);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      padding:28px;
      box-shadow: var(--shadow);
      animation:fadeInUp .6s ease both;
    }
    .auth-box h1{color:var(--brand); margin-bottom:14px; text-align:center}
    .auth-box .hint{color:var(--muted); font-size:13px; text-align:center; margin-bottom:14px}
    .auth-box .field{margin-bottom:12px}
    .auth-box input{
      width:100%; padding:12px 12px;
      border-radius:10px; border:1px solid #333;
      outline:none; font-size:15px; color:#111; background:#f4f6f8;
      transition:.25s;
    }
    .auth-box input:focus{border-color:var(--brand); box-shadow:0 0 0 3px rgba(100,255,218,.2)}
    .auth-actions{display:flex; flex-direction:column; gap:10px; margin-top:8px}
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:12px 14px; border:none; border-radius:10px; cursor:pointer;
      font-weight:700; letter-spacing:.3px; transition:.25s;
      box-shadow:0 8px 22px rgba(0,0,0,.4);
    }
    .btn-primary{background: linear-gradient(135deg,var(--brand),var(--brand2)); color:#001013}
    .btn-primary:hover{transform: translateY(-1px)}
    .btn-ghost{background:transparent; color:#fff; border:1px solid var(--line)}
    .toggle-auth{display:block; text-align:center; margin-top:6px; color:#f7df1e; text-decoration:underline; cursor:pointer}

    /* ---------- LOBBY ---------- */
    body.lobby-bg{background: radial-gradient(1000px 600px at 50% -10%, #14182a 0%, #0b0c10 55%, #000 100%)}
    #lobby-container{
      position:absolute; inset:0; display:none;
      padding:32px; overflow:auto;
    }
    .lobby-card{
      width:min(780px,94vw); margin:60px auto;
      background:var(--glass); backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.08);
      border-radius:20px; padding:24px; box-shadow:var(--shadow);
      animation:fadeInUp .5s ease both;
    }
    .lobby-card h1{color:var(--brand); text-align:center; margin-bottom:4px}
    .lobby-card .sub{color:#f7df1e; text-align:center; margin-bottom:18px}
    .lobby-grid{display:grid; grid-template-columns:1fr; gap:18px}
    .panel{
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px; padding:16px;
    }
    .panel h2{color:#f7df1e; font-size:18px; margin-bottom:10px}
    .row{display:grid; grid-template-columns:1fr; gap:10px}
    .row input,.row select{
      width:100%; padding:12px; border-radius:10px; border:1px solid #333;
      background:#f4f6f8; color:#111; font-size:15px;
    }
    .color-options{display:flex; flex-wrap:wrap; gap:8px}
    .global-color-option{width:28px;height:28px;border-radius:50%;border:2px solid transparent;cursor:pointer; transition:.2s}
    .global-color-option:hover{transform:scale(1.12); border-color:#fff}
    .global-color-option.selected{border-color:#f7df1e}
    .lobby-actions{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .sep{border:none; border-top:1px solid var(--line); margin:12px 0}

    /* ---------- GAME ---------- */
    #game-container{display:none; position:absolute; inset:0; background: radial-gradient(circle at 50% 50%, #0f0f0f 0%, #020202 75%)}
    #map{position:absolute; inset:0; background:#0c2022}
    .toggle-info-cards{
      position:absolute; top:10px; right:10px; z-index:1200;
      background:rgba(0,0,0,.6); border:1px solid var(--line); color:#fff;
      border-radius:10px; padding:8px 10px; cursor:pointer; transition:.2s;
    }
    .toggle-info-cards:hover{transform:scale(1.05)}
    /* top info */
    #top-info{
      position:fixed; top:10px; left:50%; transform:translateX(-50%);
      display:flex; flex-wrap:wrap; align-items:center; gap:10px;
      background:rgba(0,0,0,.65); border:1px solid rgba(255,255,255,.08);
      border-radius:12px; padding:8px 12px; z-index:1300; box-shadow:0 6px 18px rgba(0,0,0,.45);
    }
    #top-info p{font-size:14px}
    #top-info span{color:var(--brand); font-weight:700}
    #end-turn-btn{background:linear-gradient(135deg,#ff9966,#ff5e62); color:#fff}
    #turn-timer{background:rgba(0,0,0,.45); padding:4px 8px; border-radius:8px; color:var(--warn); font-weight:700}
    #start-game-btn{display:none; background:linear-gradient(135deg,#9be15d,#00e3ae); color:#001013}
    #start-countdown{display:none; color:var(--warn); font-weight:700}

    /* bottom icons */
    #bottom-icons{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:18px; display:flex; gap:16px; z-index:1300;
    }
    .bottom-icon-btn{
      width:52px; height:52px; border-radius:50%; border:none; cursor:pointer;
      background:linear-gradient(135deg,var(--brand),var(--brand2)); color:#001013; font-size:20px;
      display:flex; align-items:center; justify-content:center; position:relative;
      box-shadow:0 10px 20px rgba(0,0,0,.65); transition:.2s
    }
    .bottom-icon-btn:hover{transform:translateY(-2px)}
    .bottom-icon-btn[data-badge]:after{
      content:attr(data-badge); position:absolute; top:-6px; right:-6px;
      min-width:20px; min-height:20px; padding:0 6px; border-radius:999px;
      display:flex; align-items:center; justify-content:center; background:var(--danger); color:#fff; font-size:12px
    }

    /* Exit */
    #exit-room-btn{
      position:fixed; right:18px; bottom:18px; z-index:1300;
      background:linear-gradient(135deg,#ff5d5d,#ff2d2d); color:#fff
    }

    /* popups (glass) */
    .modern-popup{
      position:fixed; bottom:86px; right:18px; width:480px; max-height:72vh;
      background:var(--glass); backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px; display:none; flex-direction:column; z-index:1400; box-shadow: var(--shadow);
      animation:popupFadeIn .3s ease both;
    }
    .popup-header{
      padding:14px; background:rgba(0,0,0,.6); border-top-left-radius:14px; border-top-right-radius:14px;
      display:flex; align-items:center; justify-content:space-between; color:var(--brand); font-size:18px; text-transform:uppercase
    }
    .popup-header button{background:transparent;border:none;color:#fff; font-size:24px; cursor:pointer}
    .popup-content{flex:1; padding:16px; overflow:auto; color:#eee; font-size:15px}
    .popup-content h3{font-size:15px; color:#f7df1e; text-transform:uppercase; margin:8px 0}
    .popup-content input, .popup-content select{
      width:100%; padding:10px; border:1px solid #333; border-radius:10px; background:#fafafa; color:#111; margin-bottom:10px
    }
    .popup-content .btn{width:100%; margin-bottom:12px}

    /* chat window */
    .chat-popup{width:480px}
    .chat-messages{flex:1; padding:14px; overflow:auto; background:rgba(0,0,0,.2)}
    .chat-input-container{display:flex; border-top:1px solid var(--line)}
    .chat-input-container input{flex:1; padding:14px; border:none; outline:none; background:#181a1f; color:#eee}
    .chat-input-container button{border:none; padding:14px 16px; background:linear-gradient(135deg,var(--brand),var(--brand2)); color:#001013}
    .chat-private-container{border-top:1px solid var(--line); background:rgba(0,0,0,.25); padding:12px; display:flex; flex-direction:column; gap:8px}
    .chat-private-container h4{color:#f7df1e; font-size:13px; margin:0}

    /* players (left) */
    #players-popup{left:18px; right:auto}

    /* notifications (toasts) */
    #notification-area{position:fixed; top:16px; right:16px; z-index:1600; display:flex; flex-direction:column; gap:10px; align-items:flex-end}
    .notification-item{
      min-width:220px; max-width:380px; padding:12px 16px; border-radius:10px;
      background:linear-gradient(135deg, rgba(255,255,255,.08), rgba(0,0,0,.5));
      border:1px solid rgba(255,255,255,.15); box-shadow:0 12px 24px rgba(0,0,0,.6);
      animation: slideIn .35s ease both, fadeOut .5s ease 5.2s both;
    }
    @keyframes slideIn{from{opacity:0; transform:translateX(60px)} to{opacity:1; transform:translateX(0)}}
    @keyframes fadeOut{to{opacity:0; transform:translateX(60px)}}
    @keyframes fadeInUp{from{opacity:0; transform:translateY(24px)} to{opacity:1; transform:translateY(0)}}
    @keyframes popupFadeIn{from{opacity:0; transform:translateY(12px)} to{opacity:1; transform:translateY(0)}}

    /* tooltips */
    .leaflet-tooltip{background:transparent; border:none; color:#fff; font-family:"Montserrat",sans-serif; font-size:13px}
    .country-popup-tooltip{
      background:rgba(0,0,0,.78); border:1px solid rgba(255,255,255,.08); border-radius:8px; padding:8px 10px;
      box-shadow:0 6px 18px rgba(0,0,0,.5)
    }

    /* profile popup (friends & requests) */
    #profile-popup{width:480px; right:18px}
    .profile-section{padding:10px; border-radius:10px; background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); margin-bottom:12px}
    .profile-section h3{color:#f7df1e; font-size:14px; margin-bottom:8px}
    .friend-item,.friend-request-item,.room-invite-item{
      background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08);
      border-radius:8px; padding:10px; display:flex; align-items:center; justify-content:space-between; margin-bottom:8px
    }
    .profile-actions button{margin-left:6px}

    /* flag editor */
    #flag-editor-popup{width:min(560px,94vw)}
    #flag-canvas{width:100%; height:260px; background:#fff; border-radius:12px; border:1px solid #ddd}

    /* responsive */
    @media (max-width: 768px){
      #top-info{gap:8px; padding:8px 10px}
      #bottom-icons{gap:12px}
      .bottom-icon-btn{width:48px; height:48px; font-size:18px}
      #exit-room-btn{bottom:86px}
      .modern-popup, .chat-popup, #profile-popup, #players-popup{width:92vw; left:4vw; right:auto}
    }
  </style>
</head>

<body>

  <!-- ============ AUTH ============ -->
  <div id="auth-container">
    <div class="auth-box">
      <h1 id="auth-title">Giriş Yap</h1>
      <p class="hint">Hesabın yok mu? <span id="toggle-auth" class="toggle-auth">Kayıt olmak için tıkla</span></p>

      <!-- Login fields -->
      <div id="auth-login-fields">
        <div class="field"><input id="auth-email" type="email" placeholder="Email" autocomplete="username"/></div>
        <div class="field"><input id="auth-password" type="password" placeholder="Şifre" autocomplete="current-password"/></div>
      </div>

      <!-- Register fields -->
      <div id="auth-register-fields" style="display:none;">
        <div class="field"><input id="auth-displayName" type="text" placeholder="Kullanıcı Adı"/></div>
        <div class="field"><input id="auth-email-reg" type="email" placeholder="Email" autocomplete="username"/></div>
        <div class="field"><input id="auth-password-reg" type="password" placeholder="Şifre" autocomplete="new-password"/></div>
        <div class="field"><input id="auth-passwordConfirm" type="password" placeholder="Şifre Tekrar" autocomplete="new-password"/></div>
      </div>

      <div class="auth-actions">
        <button id="auth-action-btn" class="btn btn-primary"><i class="fa-solid fa-right-to-bracket"></i><span>Giriş Yap</span></button>
        <button id="auth-google-btn" class="btn btn-ghost"><i class="fa-brands fa-google"></i> Google ile devam et</button>
      </div>
    </div>
  </div>

  <!-- ============ LOBBY ============ -->
  <div id="lobby-container" class="animate__animated animate__fadeIn">
    <div class="lobby-card">
      <h1>GLOBAL CONQUEST</h1>
      <div class="sub">Oda oluştur veya bir odaya katıl</div>

      <div class="lobby-grid">
        <!-- Oda oluştur -->
        <div class="panel">
          <h2>Oda Oluştur</h2>
          <div class="row">
            <input id="creator-player-name" type="text" placeholder="Adınız"/>
            <div>
              <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;">
                <span style="color:#cfd6dc; font-size:13px">Renk Seç</span>
                <small style="color:#9aa5b1">Harita etiket rengi</small>
              </div>
              <div id="creator-color-options" class="color-options"></div>
            </div>
            <input id="max-players" type="number" min="2" max="8" placeholder="Oyuncu Sayısı (2-8)"/>
          </div>
          <div class="lobby-actions" style="margin-top:10px">
            <button id="create-room-btn" class="btn btn-primary"><i class="fa-solid fa-plus"></i> Oda Oluştur</button>
            <button id="edit-flag-btn" class="btn btn-ghost"><i class="fa-solid fa-flag"></i> Bayrağımı Düzenle</button>
          </div>
        </div>

        <!-- Odaya katıl -->
        <div class="panel">
          <h2>Odaya Katıl</h2>
          <div class="row">
            <input id="join-player-name" type="text" placeholder="Adınız"/>
            <div>
              <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;">
                <span style="color:#cfd6dc; font-size:13px">Renk Seç</span>
                <small style="color:#9aa5b1">Harita etiket rengi</small>
              </div>
              <div id="join-color-options" class="color-options"></div>
            </div>
            <input id="room-code" type="text" placeholder="Oda Kodu (Örn: AB12CD)"/>
          </div>
          <div class="lobby-actions" style="margin-top:10px">
            <button id="join-room-btn" class="btn btn-primary"><i class="fa-solid fa-right-to-bracket"></i> Odaya Katıl</button>
            <button id="watch-room-btn" class="btn btn-ghost"><i class="fa-solid fa-eye"></i> İzleyici Olarak Gir</button>
          </div>
        </div>
      </div>

      <hr class="sep" />

      <div class="panel">
        <h2>Aktif Odalar</h2>
        <div id="active-rooms-list"></div>
      </div>
    </div>
  </div>

  <!-- ============ NOTIFICATIONS ============ -->
  <div id="notification-area"></div>

  <!-- ============ GAME ============ -->
  <div id="game-container">
    <div id="map"></div>
    <button id="toggle-info-cards" class="toggle-info-cards" title="Bilgi kartları"><i class="fas fa-eye-slash"></i></button>

    <div id="top-info">
      <p>Oda: <span id="display-room-name">-</span> <small style="color:#9aa5b1">(<span id="display-room-code">-</span>)</small></p>
      <p>Tur: <span id="current-round">1</span></p>
      <p>Sıra: <span id="current-player">?</span></p>
      <button id="end-turn-btn" class="btn"><i class="fas fa-forward"></i> Tur Sonu <span id="turn-timer">60s</span></button>
      <button id="start-game-btn" class="btn">Oyunu Başlat</button>
      <span id="start-countdown">30</span>
    </div>

    <div id="bottom-icons">
      <button id="open-players-btn" class="bottom-icon-btn" title="Oyuncular"><i class="fas fa-users"></i></button>
      <button id="open-military-btn" class="bottom-icon-btn" title="Asker İşlemleri"><i class="fas fa-shield-halved"></i></button>
      <button id="open-building-btn" class="bottom-icon-btn" title="Bina Kurma"><i class="fas fa-building"></i></button>
      <button id="open-resource-btn" class="bottom-icon-btn" title="Kaynak Gönder"><i class="fas fa-hand-holding-dollar"></i></button>
      <button id="open-market-btn" class="bottom-icon-btn" title="Ticaret Merkezi"><i class="fas fa-store"></i></button>
      <button id="open-pact-btn" class="bottom-icon-btn" title="Saldırmazlık Pakti"><i class="fas fa-handshake"></i></button>
      <button id="open-chat-btn" class="bottom-icon-btn" title="Sohbet"><i class="fas fa-comments"></i></button>
      <button id="open-profile-btn" class="bottom-icon-btn" title="Profil & Arkadaşlar"><i class="fas fa-user"></i></button>
      <button id="open-notifications-btn" class="bottom-icon-btn" title="Bildirimleri Aç/Kapat"><i class="fas fa-bell"></i></button>
    </div>

    <button id="exit-room-btn" class="btn">Odadan Çık</button>
  </div>

  <!-- ============ PLAYERS POPUP ============ -->
  <div id="players-popup" class="modern-popup">
    <div class="popup-header">
      <span>Oyuncu Bilgileri</span>
      <button id="close-players-btn">&times;</button>
    </div>
    <div id="players-info" class="popup-content"></div>
  </div>

  <!-- ============ MILITARY POPUP ============ -->
  <div id="military-popup" class="modern-popup">
    <div class="popup-header">
      <span>Asker İşlemleri</span>
      <button id="close-military-btn">&times;</button>
    </div>
    <div class="popup-content">
      <h3>Saldırı</h3>
      <p style="color:#cfd6dc; font-size:13px">Haritadan hedef ülkeyi seçin. Gönderilecek asker: (1 asker = 1 varil petrol)</p>
      <input id="attack-soldiers" type="number" min="1" placeholder="Asker sayısı"/>
      <button id="attack-btn" class="btn btn-primary"><i class="fas fa-crosshairs"></i> Saldırı Yap</button>

      <h3>Asker Satın Al</h3>
      <p style="color:#cfd6dc; font-size:13px">(1 Asker = 10$ + 25 Buğday)</p>
      <input id="soldiers-to-buy" type="number" min="1" placeholder="Adet"/>
      <button id="buy-soldiers-btn" class="btn btn-primary"><i class="fas fa-user-plus"></i> Satın Al</button>

      <h3>Asker Çek</h3>
      <input id="pull-soldiers-count" type="number" min="1" placeholder="Asker sayısı"/>
      <button id="pull-soldiers-btn" class="btn btn-primary"><i class="fas fa-person-walking-arrow-right"></i> Asker Çek</button>

      <h3>Askeri Destek Gönder</h3>
      <label style="color:#cfd6dc; font-size:13px">Oyuncu</label>
      <select id="support-recipient"></select>
      <label style="color:#cfd6dc; font-size:13px">Ülke</label>
      <select id="support-recipient-country"></select>
      <input id="support-soldiers" type="number" min="1" placeholder="Asker sayısı"/>
      <button id="send-support-btn" class="btn btn-primary"><i class="fas fa-hands-holding-circle"></i> Destek Gönder</button>
    </div>
  </div>

  <!-- ============ BUILDING POPUP ============ -->
  <div id="building-popup" class="modern-popup">
    <div class="popup-header">
      <span>Bina Kurma</span>
      <button id="close-building-btn">&times;</button>
    </div>
    <div class="popup-content">
      <h3>Kışla Kur</h3>
      <p style="color:#cfd6dc; font-size:13px">(1 Kışla = 300$ + 50 Varil + 120 Buğday)</p>
      <input id="barracks-quantity" type="number" min="1" placeholder="Adet"/>
      <button id="buy-barracks-btn" class="btn btn-primary"><i class="fas fa-tent"></i> Kışla Kur</button>

      <h3>Fabrika Kur</h3>
      <p style="color:#cfd6dc; font-size:13px">(1 Fabrika = 500$ + 130 Varil)</p>
      <input id="factory-quantity" type="number" min="1" placeholder="Adet"/>
      <button id="build-factory-btn" class="btn btn-primary"><i class="fas fa-industry"></i> Fabrika Kur</button>

      <h3>Rafine Kur</h3>
      <p style="color:#cfd6dc; font-size:13px">(1 Rafine = 800$ + 250 Varil)</p>
      <input id="refinery-quantity" type="number" min="1" placeholder="Adet"/>
      <button id="build-refinery-btn" class="btn btn-primary"><i class="fas fa-oil-can"></i> Rafine Kur</button>

      <h3>Değirmen Kur</h3>
      <p style="color:#cfd6dc; font-size:13px">(1 Değirmen = 200$ + 100 Varil)</p>
      <input id="grainmill-quantity" type="number" min="1" placeholder="Adet"/>
      <button id="build-grainmill-btn" class="btn btn-primary"><i class="fas fa-wheat-awn"></i> Değirmen Kur</button>

      <h3>Kale Kur</h3>
      <p style="color:#cfd6dc; font-size:13px">1 Kale = 1000$ + 1000 Varil + 1000 Buğday — ülkede sadece 1 kale olabilir. Kale saldıranı %5 (seviye başına) öldürür.</p>
      <button id="build-castle-btn" class="btn btn-primary"><i class="fas fa-chess-rook"></i> Kale Kur</button>

      <h3>Kale Güçlendirme</h3>
      <p style="color:#cfd6dc; font-size:13px">Her güçlendirme +%5 (maks %30). İlk güçlendirme: 1300$ + 1300 Varil + 1300 Buğday. Sonrakiler %30 artar.</p>
      <p style="color:var(--brand)">Mevcut / Sonraki Fiyat: <span id="castle-upgrade-cost-text">-</span></p>
      <button id="upgrade-castle-btn" class="btn btn-primary"><i class="fas fa-arrow-up"></i> Kale Güçlendir</button>
    </div>
  </div>

  <!-- ============ RESOURCE POPUP ============ -->
  <div id="resource-popup" class="modern-popup">
    <div class="popup-header">
      <span>Kaynak Gönder</span>
      <button id="close-resource-btn">&times;</button>
    </div>
    <div class="popup-content">
      <h3>Para Gönder</h3>
      <input id="money-to-send" type="number" min="1" placeholder="Miktar ($)"/>
      <select id="recipient-player"></select>
      <button id="send-money-btn" class="btn btn-primary"><i class="fas fa-sack-dollar"></i> Gönder</button>

      <h3>Petrol Gönder</h3>
      <input id="petrol-to-send" type="number" min="1" placeholder="Varil"/>
      <select id="recipient-player-petrol"></select>
      <button id="send-petrol-btn" class="btn btn-primary"><i class="fas fa-gas-pump"></i> Gönder</button>

      <h3>Buğday Gönder</h3>
      <input id="wheat-to-send" type="number" min="1" placeholder="Adet"/>
      <select id="recipient-player-wheat"></select>
      <button id="send-wheat-btn" class="btn btn-primary"><i class="fas fa-wheat-awn"></i> Gönder</button>
    </div>
  </div>

  <!-- ============ CHAT POPUP ============ -->
  <div id="chat-popup" class="chat-popup modern-popup">
    <div class="popup-header">
      <span>Sohbet</span>
      <button id="close-chat-btn">&times;</button>
    </div>
    <div id="chat-messages" class="chat-messages"></div>
    <div class="chat-input-container">
      <input id="chat-input" type="text" placeholder="Mesajınızı yazın..."/>
      <button id="send-chat-btn"><i class="fas fa-paper-plane"></i></button>
    </div>
    <div class="chat-private-container">
      <h4>Özel Mesaj</h4>
      <select id="private-message-recipient"></select>
      <input id="private-message-input" type="text" placeholder="Özel mesajınız..."/>
      <button id="send-private-message-btn"><i class="fas fa-user-secret"></i> Gönder</button>
    </div>
  </div>

  <!-- ============ PACT POPUP ============ -->
  <div id="pact-popup" class="modern-popup">
    <div class="popup-header">
      <span>Saldırmazlık Pakti</span>
      <button id="close-pact-btn">&times;</button>
    </div>
    <div class="popup-content">
      <h3>Yeni Pakt Teklifi</h3>
      <select id="pact-offer-recipient"></select>
      <input id="pact-duration" type="number" min="1" placeholder="Tur sayısı"/>
      <input id="pact-cost" type="number" min="0" placeholder="Tek seferlik para ($)"/>
      <button id="send-pact-offer-btn" class="btn btn-primary">Teklif Gönder</button>

      <h3>Gelen Teklifler</h3>
      <div id="pact-pending-offers"></div>

      <h3>Aktif Paktlar</h3>
      <div id="active-pacts-container"></div>
    </div>
  </div>

  <!-- ============ MARKET POPUP ============ -->
  <div id="market-popup" class="modern-popup">
    <div class="popup-header">
      <span>Ticaret Merkezi</span>
      <button id="close-market-btn">&times;</button>
    </div>
    <div class="popup-content">
      <h3>Yeni Teklif</h3>
      <label style="color:#cfd6dc; font-size:13px">Ürün</label>
      <select id="trade-item-type">
        <option value="petrol">Petrol</option>
        <option value="wheat">Buğday</option>
      </select>
      <label style="color:#cfd6dc; font-size:13px">Miktar</label>
      <input id="trade-quantity" type="number" min="1" placeholder="Miktar"/>
      <label style="color:#cfd6dc; font-size:13px">Birim Fiyat ($)</label>
      <input id="trade-price" type="number" min="1" placeholder="Fiyat"/>
      <label style="color:#cfd6dc; font-size:13px">Ambargo (oyuncular)</label>
      <select id="embargo-players" multiple style="width:100%; min-height:56px"></select>
      <button id="create-trade-offer-btn" class="btn btn-primary">Teklifi Oluştur</button>

      <h3>Mevcut Teklifler</h3>
      <div id="trade-offers-list"></div>
    </div>
  </div>

  <!-- ============ PROFILE POPUP ============ -->
  <div id="profile-popup" class="modern-popup">
    <div class="popup-header">
      <span>Profil & Arkadaşlar</span>
      <button id="close-profile-btn">&times;</button>
    </div>
    <div class="popup-content">
      <div class="profile-section">
        <h3>Profil</h3>
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px">
          <div id="profile-flag" style="width:48px;height:32px;background:#ddd;border-radius:6px;overflow:hidden"></div>
          <div>
            <div id="profile-username" style="font-weight:700">Kullanıcı</div>
            <small id="profile-email" style="color:#9aa5b1"></small>
          </div>
          <div style="margin-left:auto; display:flex; gap:8px">
            <button id="profile-logout-btn" class="btn btn-ghost" title="Çıkış"><i class="fa-solid fa-arrow-right-from-bracket"></i></button>
            <button id="profile-edit-flag-btn" class="btn btn-ghost" title="Bayrak Düzenle"><i class="fa-solid fa-pen"></i></button>
          </div>
        </div>
      </div>

      <div class="profile-section">
        <h3>Arkadaş Listesi</h3>
        <div id="friend-list"></div>
      </div>

      <div class="profile-section">
        <h3>Gelen İstekler</h3>
        <div id="incoming-requests"></div>
      </div>

      <div class="profile-section">
        <h3>Arkadaş Ekle</h3>
        <div style="display:flex; gap:8px">
          <input id="friend-request-username" type="text" placeholder="Kullanıcı Adı"/>
          <button id="send-friend-request-btn" class="btn btn-primary" style="min-width:140px">İstek Gönder</button>
        </div>
      </div>

      <div class="profile-section">
        <h3>Oyun Davetleri</h3>
        <div id="incoming-invites"></div>
      </div>
    </div>
  </div>

  <!-- ============ FLAG EDITOR POPUP ============ -->
  <div id="flag-editor-popup" class="modern-popup">
    <div class="popup-header">
      <span>Bayrak Düzenleyici</span>
      <button id="close-flag-editor-btn">&times;</button>
    </div>
    <div class="popup-content">
      <canvas id="flag-canvas" width="512" height="280"></canvas>

      <div style="display:grid; grid-template-columns: repeat(2,1fr); gap:10px; margin-top:12px">
        <div class="panel" style="padding:12px">
          <h3>Fırça</h3>
          <label style="color:#cfd6dc; font-size:13px">Renk</label>
          <input id="flag-color" type="color" value="#ff0000" />
          <label style="color:#cfd6dc; font-size:13px">Boyut</label>
          <input id="flag-brush-size" type="range" min="1" max="40" value="6" />
          <div style="display:flex; gap:8px; margin-top:8px">
            <button id="flag-erase-btn" class="btn btn-ghost">Silgi</button>
            <button id="flag-clear-btn" class="btn btn-ghost">Temizle</button>
          </div>
        </div>
        <div class="panel" style="padding:12px">
          <h3>Kaydet</h3>
          <p style="color:#cfd6dc; font-size:13px">Çizimi PNG olarak profilinize kaydedin. Ülkeleriniz bu bayrakla renklenecek.</p>
          <button id="save-flag-btn" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> Kaydet</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ============ SCRIPTS (libs only; gameLogic will be provided separately) ============ -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <!-- <script src="gameLogic.js"></script> -->
</body>
</html>

