<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Global Conquest - Online</title>
  <meta http-equiv="Content-Security-Policy"
      content="default-src 'self' https: data: blob:;
               script-src 'self' https://www.gstatic.com https://www.googleapis.com https://unpkg.com https://cdnjs.cloudflare.com 'unsafe-eval';
               style-src  'self' 'unsafe-inline' https://fonts.googleapis.com https://unpkg.com https://cdnjs.cloudflare.com;
               img-src    'self' data: blob: https:;
               font-src   'self' https://fonts.gstatic.com data:;
               connect-src 'self' https://warmapg-77acb-default-rtdb.firebaseio.com https://www.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com;">


  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet"/>

  <!-- Leaflet Core -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <!-- Leaflet Pattern (bayrak dokusu için) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.pattern/leaflet.pattern.css" />

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>

  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <style>
    :root{
      --bg1:#0f1114;
      --bg2:#161a1d;
      --panel: rgba(0,0,0,.45);
      --glass: rgba(255,255,255,.06);
      --accent:#64ffda;
      --accent-2:#00c9ff;
      --warn:#f39c12;
      --danger:#ff4b4b;
      --text:#eeeeee;
      --muted:#b6b8bb;
      --border: rgba(255,255,255,.12);
      --shadow: 0 12px 28px rgba(0,0,0,.6);
      --radius:14px;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:"Montserrat",sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 15% -10%, #1c2030 0%, transparent 60%),
        radial-gradient(1000px 700px at 110% 10%, #102125 0%, transparent 55%),
        linear-gradient(135deg, #121418, #0a0b0d 70%);
      min-height:100vh;
      overflow-x:hidden;
    }
    h1,h2,h3,h4{font-family:"Orbitron",sans-serif;letter-spacing:.5px;text-transform:uppercase}

    /* ====== Auth ====== */
    #auth-container{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      background: linear-gradient(135deg, #150f2f 0%, #1b1638 50%, #0a0b0d 100%);
      z-index:9999;
    }
    .auth-card{
      width:95%; max-width:880px;
      background:var(--panel);
      backdrop-filter: blur(10px);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display:grid; grid-template-columns: 1.2fr 1fr;
      overflow:hidden;
    }
    .auth-left{
      padding:28px;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-right:1px solid var(--border);
    }
    .auth-title{color:var(--accent); font-size:28px; margin-bottom:6px}
    .auth-sub{color:var(--muted); font-size:14px; margin-bottom:16px}
    .tabbar{display:flex; gap:8px; margin: 8px 0 16px}
    .tabbar button{
      flex:1; padding:10px 12px; border:1px solid var(--border);
      background: rgba(0,0,0,.35); color:#fff; cursor:pointer; border-radius:8px;
    }
    .tabbar button.active{outline:2px solid var(--accent); background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:#000; font-weight:700}
    .auth-form{display:none; gap:10px; margin-top:6px}
    .auth-form.active{display:grid}
    .form-row{display:flex; gap:10px}
    .auth-form input{
      width:100%; padding:12px; border-radius:10px; border:1px solid var(--border);
      outline:none; background:#fafafa; color:#111; font-size:15px;
    }
    .auth-form .btn{
      padding:12px; border:none; border-radius:10px; cursor:pointer; font-weight:700;
      background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#000;
      box-shadow: 0 8px 18px rgba(0,0,0,.4);
    }
    .auth-right{
      padding:28px;
      display:flex; flex-direction:column; gap:14px; align-items:flex-start; justify-content:center;
      background:
        radial-gradient(700px 500px at -10% -20%, #22313b80 0%, transparent 60%),
        linear-gradient(160deg, #07090c, #0e1014);
    }
    .hero{font-size:32px; line-height:1.2}
    .hero strong{color:var(--accent)}
    .mini{color:var(--muted); font-size:13px}

    /* ====== Profile (Lobbyless Hub) ====== */
    #profile-container{
      display:none;
      padding:24px;
      min-height:100vh;
    }
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      margin-bottom:18px;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .brand i{font-size:22px; color:var(--accent)}
    .brand h1{font-size:22px; letter-spacing:1px}
    .userbox{
      display:flex; align-items:center; gap:12px; background:var(--panel); border:1px solid var(--border);
      padding:10px 14px; border-radius:12px;
    }
    #profile-username{font-weight:700}
    .userbox .btn-ghost{
      border:1px solid var(--border); background: transparent; color:#fff; padding:8px 12px; cursor:pointer; border-radius:10px;
    }
    .grid{
      display:grid; gap:16px;
      grid-template-columns: 1.1fr 1fr 1fr;
    }
    .card{
      background:var(--panel); border:1px solid var(--border); border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden; display:flex; flex-direction:column;
    }
    .card .card-h{
      padding:14px 16px; background: rgba(255,255,255,.04); border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between;
    }
    .card .card-h h2{font-size:14px; color:var(--accent); letter-spacing:1px}
    .card .card-b{padding:14px 16px; display:flex; flex-direction:column; gap:10px}
    .list{
      display:flex; flex-direction:column; gap:10px; max-height:300px; overflow:auto;
    }
    .row{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:10px; border:1px solid var(--border); border-radius:10px; background: rgba(255,255,255,.03);
    }
    .row .actions{display:flex; gap:8px}
    .btn{
      padding:10px 12px; border:none; border-radius:10px; cursor:pointer; font-weight:700;
      background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#000;
    }
    .btn-red{
      background: linear-gradient(135deg, #ff7a7a, #ff3b3b); color:#fff; border:none; border-radius:10px; padding:8px 12px; cursor:pointer;
    }
    .btn-ghost{border:1px solid var(--border); background: transparent; color:#fff; padding:8px 12px; cursor:pointer; border-radius:10px}
    .muted{color:var(--muted); font-size:13px}
    .inputs{display:flex; gap:8px; flex-wrap:wrap}
    .inputs input, .inputs select{
      flex:1; min-width:160px; padding:10px; border-radius:10px; border:1px solid var(--border); outline:none; background:#fafafa; color:#111;
    }
    .inline{display:flex; gap:8px; align-items:center; flex-wrap:wrap}

    /* ====== Game Screen ====== */
    #game-container{display:none; height:100vh; position:relative}
    #map{position:absolute; inset:0; background:#0c2022}
    #toggle-info-cards{
      position:absolute; top:10px; right:10px; z-index:1100;
      background:rgba(0,0,0,.6); border:1px solid var(--border); color:#fff; border-radius:10px; padding:8px 12px; cursor:pointer;
    }
    #top-info{
      position:fixed; top:10px; left:50%; transform:translateX(-50%); z-index:1200;
      background:var(--panel); border:1px solid var(--border); border-radius:12px; display:flex; gap:12px; align-items:center;
      padding:8px 14px; box-shadow: var(--shadow);
    }
    #top-info p{font-size:14px}
    #top-info p span{color:var(--accent); font-weight:700}
    #end-turn-btn, #start-game-btn{
      border:none; border-radius:10px; padding:8px 12px; cursor:pointer; font-weight:700;
    }
    #end-turn-btn{background: linear-gradient(135deg,#ff9966,#ff5e62); color:#fff}
    #start-game-btn{background: linear-gradient(135deg,#9be15d,#00e3ae); color:#000; display:none}
    #turn-timer{font-size:14px; color:var(--warn); background: rgba(0,0,0,.5); padding:3px 8px; border-radius:6px}
    #start-countdown{color:var(--warn); display:none}

    #bottom-icons{
      position:fixed; bottom:20px; left:50%; transform:translateX(-50%); z-index:1200;
      display:flex; gap:16px;
    }
    .bottom-icon-btn{
      width:50px; height:50px; border-radius:50%; border:none; cursor:pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#000; font-size:20px;
      box-shadow:0 10px 20px rgba(0,0,0,.5); position:relative;
    }
    .bottom-icon-btn[data-badge]::after{
      content: attr(data-badge); position:absolute; top:-6px; right:-6px; min-width:20px; min-height:20px; font-size:12px;
      display:grid; place-items:center; border-radius:999px; background:var(--danger); color:#fff; padding:2px 6px;
    }
    #exit-room-btn{
      position:fixed; bottom:20px; right:20px; z-index:1200; padding:10px 14px; border-radius:10px; border:none; cursor:pointer;
      background: linear-gradient(135deg, #ff5d5d, #ff2d2d); color:#fff;
      box-shadow:0 10px 20px rgba(0,0,0,.5);
    }

    /* ====== Popups (glass) ====== */
    .modern-popup{
      position:fixed; bottom:84px; right:20px; width:460px; max-height:70vh; z-index:1300;
      display:none; flex-direction:column; background:var(--panel); border:1px solid var(--border); border-radius:var(--radius);
      box-shadow: var(--shadow); backdrop-filter: blur(10px);
    }
    .modern-popup .popup-header{
      padding:14px; background: rgba(255,255,255,.04); border-bottom:1px solid var(--border);
      display:flex; align-items:center; justify-content:space-between; color:var(--accent);
    }
    .modern-popup .popup-header button{border:none;background:transparent;color:#fff;font-size:22px;cursor:pointer}
    .modern-popup .popup-content{
      padding:16px; overflow:auto; display:flex; flex-direction:column; gap:10px; font-size:15px;
    }
    .modern-popup .popup-content input, .modern-popup .popup-content select{
      width:100%; padding:10px; border-radius:8px; border:1px solid var(--border); background:#fafafa; color:#111;
    }
    .modern-popup .popup-content button{
      border:none; border-radius:10px; padding:10px 12px; cursor:pointer; font-weight:700;
      background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#000;
    }

    /* Players Left Popup */
    #players-popup{left:20px; right:auto}

    /* Chat */
    .chat-popup{display:none}
    .chat-header{padding:14px; background: rgba(255,255,255,.04); border-bottom:1px solid var(--border); display:flex; align-items:center; justify-content:space-between; color:var(--accent)}
    .chat-messages{flex:1; padding:14px; overflow:auto; background:rgba(0,0,0,.2)}
    .chat-input-container{display:flex; border-top:1px solid var(--border)}
    .chat-input-container input{flex:1; padding:12px; border:none; outline:none; background:#1e1e1e; color:#eee}
    .chat-input-container button{padding:12px; border:none; background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#000; cursor:pointer}
    .chat-private-container{border-top:1px solid var(--border); padding:12px; background:rgba(0,0,0,.25); display:flex; flex-direction:column; gap:8px}

    /* Profile flyout (friends/invites) — we integrate inside profile-container as cards */

    /* Notifications */
    #notification-area{position:fixed; top:18px; right:20px; z-index:2000; display:flex; flex-direction:column; gap:10px}
    .notification-item{
      min-width:220px; max-width:380px; padding:12px 16px; border-radius:10px;
      background: linear-gradient(135deg, rgba(255,255,255,.1), rgba(0,0,0,.5));
      border:1px solid var(--border); box-shadow: var(--shadow); opacity:0; transform: translateX(100%);
      animation: slideIn .45s forwards, fadeOut .5s 5.5s forwards;
    }
    @keyframes slideIn{to{opacity:1; transform:none}}
    @keyframes fadeOut{to{opacity:0; transform: translateX(100%)}}

    /* Responsive */
    @media (max-width: 1024px){
      .grid{grid-template-columns: 1fr 1fr}
      .auth-card{grid-template-columns: 1fr}
      .auth-right{display:none}
    }
    @media (max-width: 720px){
      .grid{grid-template-columns:1fr}
      .modern-popup{width:92%; left:4%; right:auto}
      #top-info{flex-direction:column; gap:6px}
      #bottom-icons{gap:10px}
      .bottom-icon-btn{width:44px;height:44px;font-size:18px}
    }
  </style>
</head>
<body>

  <!-- ============ AUTH ============ -->
  <div id="auth-container">
    <div class="auth-card animate__animated animate__fadeInUp">
      <div class="auth-left">
        <div class="auth-title">Global Conquest</div>
        <div class="auth-sub">Hesabınla giriş yap ya da yeni bir komutan oluştur.</div>

        <div class="tabbar">
          <button id="login-tab" class="active">Giriş</button>
          <button id="register-tab">Kayıt</button>
        </div>

        <!-- Login -->
        <div id="login-form" class="auth-form active">
          <input id="login-email" type="email" placeholder="Email" />
          <input id="login-password" type="password" placeholder="Şifre" />
          <button id="login-btn" class="btn">Giriş Yap</button>
        </div>

        <!-- Register -->
        <div id="register-form" class="auth-form">
          <div class="form-row">
            <input id="register-display-name" type="text" placeholder="Kullanıcı Adı" />
          </div>
          <input id="register-email" type="email" placeholder="Email" />
          <div class="form-row">
            <input id="register-password" type="password" placeholder="Şifre" />
            <input id="register-confirm-password" type="password" placeholder="Şifre Tekrar" />
          </div>
          <button id="register-btn" class="btn">Kayıt Ol</button>
        </div>
      </div>

      <div class="auth-right">
        <div class="hero">Dünyayı <strong>fethet</strong>, <br/>stratejiyle <strong>yönet</strong>.</div>
        <div class="mini">Gerçek zamanlı lobiler, harita üzerinde ülkeler, üretim & ticaret, paktlar, sohbet ve daha fazlası.</div>
      </div>
    </div>
  </div>

  <!-- ============ PROFILE / HUB ============ -->
  <div id="profile-container">
    <div class="topbar">
      <div class="brand">
        <i class="fas fa-globe"></i>
        <h1>Global Conquest</h1>
      </div>
      <div class="userbox">
        <span id="profile-username">-</span>
        <button id="edit-flag-btn" class="btn-ghost"><i class="fas fa-flag"></i> Bayrağı Düzenle</button>
        <button id="profile-logout-btn" class="btn-ghost"><i class="fas fa-right-from-bracket"></i> Çıkış</button>
      </div>
    </div>

    <div class="grid">
      <!-- Friends -->
      <div class="card">
        <div class="card-h"><h2>Arkadaşlar</h2></div>
        <div class="card-b">
          <div class="inputs">
            <input id="add-friend-username" type="text" placeholder="Kullanıcı adı ile ekle" />
            <button id="send-friend-request-btn" class="btn"><i class="fas fa-user-plus"></i> İstek Gönder</button>
          </div>
          <div class="muted">Listem</div>
          <div id="friend-list" class="list"></div>
          <div class="muted">Gelen istekler</div>
          <div id="friend-request-list" class="list"></div>
        </div>
      </div>

      <!-- Room Invites & Join Requests -->
      <div class="card">
        <div class="card-h"><h2>Oda Davetleri / Katılma İstekleri</h2></div>
        <div class="card-b">
          <div id="room-invite-list" class="list"></div>
          <div class="muted">Host olduğun odalara gelen katılma istekleri burada görünür.</div>
        </div>
      </div>

      <!-- Create Room -->
      <div class="card">
        <div class="card-h"><h2>Oda Kur</h2></div>
        <div class="card-b">
          <div class="inputs">
            <input id="room-name-input" type="text" placeholder="Oda adı" />
          </div>
          <div class="muted">Arkadaşlarını davet et (çoklu seçim):</div>
          <select id="room-invite-friends" multiple style="min-height:120px; background:#fafafa; color:#111; border:1px solid var(--border); border-radius:10px;"></select>
          <button id="create-room-btn" class="btn"><i class="fas fa-plus"></i> Oda Oluştur</button>
          <div class="muted">Veya aşağıdan aktif odalara katıl / izle.</div>
        </div>
      </div>

      <!-- Active Rooms -->
      <div class="card" style="grid-column: 1 / -1;">
        <div class="card-h"><h2>Aktif Odalar</h2></div>
        <div class="card-b">
          <div id="active-rooms-list" class="list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============ GAME ============ -->
  <div id="game-container">
    <div id="map"></div>
    <button id="toggle-info-cards"><i class="fas fa-eye-slash"></i></button>

    <div id="top-info">
      <p>Oda: <span id="display-room-name">-</span> | Tur: <span id="current-round">1</span> | Sıra: <span id="current-player">-</span></p>
      <button id="end-turn-btn"><i class="fas fa-forward"></i> Tur Sonu <span id="turn-timer">60s</span></button>
      <button id="start-game-btn">Oyunu Başlat</button>
      <span id="start-countdown">30</span>
    </div>

    <div id="bottom-icons">
      <button id="open-players-btn" class="bottom-icon-btn" title="Oyuncular"><i class="fas fa-users"></i></button>
      <button id="open-military-btn" class="bottom-icon-btn" title="Asker İşlemleri"><i class="fas fa-shield-alt"></i></button>
      <button id="open-building-btn" class="bottom-icon-btn" title="Bina Kurma"><i class="fas fa-building"></i></button>
      <button id="open-resource-btn" class="bottom-icon-btn" title="Kaynak Gönderme"><i class="fas fa-hand-holding-usd"></i></button>
      <button id="open-market-btn" class="bottom-icon-btn" title="Ticaret Merkezi"><i class="fas fa-store"></i></button>
      <button id="open-pact-btn" class="bottom-icon-btn" title="Saldırmazlık Pakti"><i class="fas fa-handshake"></i></button>
      <button id="open-chat-btn" class="bottom-icon-btn" title="Sohbet"><i class="fas fa-comments"></i></button>
      <button id="open-profile-btn" class="bottom-icon-btn" title="Profil"><i class="fas fa-user"></i></button>
      <button id="open-notifications-btn" class="bottom-icon-btn" title="Bildirimler"><i class="fas fa-bell"></i></button>
    </div>

    <button id="exit-room-btn">Odadan Çık</button>
  </div>

  <!-- ====== Notifications ====== -->
  <div id="notification-area"></div>

  <!-- ====== Players Popup (Left) ====== -->
  <div id="players-popup" class="modern-popup">
    <div class="popup-header" id="players-popup-header">
      <span>Oyuncu Bilgileri</span>
      <button id="close-players-btn">&times;</button>
    </div>
    <div class="popup-content" id="players-info"></div>
  </div>

  <!-- ====== Military Popup ====== -->
  <div id="military-popup" class="modern-popup">
    <div class="popup-header" id="military-popup-header">
      <span>Asker İşlemleri</span>
      <button id="close-military-btn">&times;</button>
    </div>
    <div class="popup-content">
      <h3>Saldırı</h3>
      <p class="muted">Hedef ülkeyi haritadan seçin. (1 asker = 1 varil petrol)</p>
      <input type="number" id="attack-soldiers" placeholder="Asker sayısı" min="1" />
      <button id="attack-btn"><i class="fas fa-crosshairs"></i> Saldırı Yap</button>

      <h3>Asker Satın Al</h3>
      <p class="muted">(1 Asker = 10$ + 25 Buğday)</p>
      <input type="number" id="soldiers-to-buy" placeholder="Adet" min="1" />
      <button id="buy-soldiers-btn"><i class="fas fa-user-plus"></i> Satın Al</button>

      <h3>Asker Çek</h3>
      <input type="number" id="pull-soldiers-count" placeholder="Asker sayısı" min="1" />
      <button id="pull-soldiers-btn"><i class="fas fa-person-running"></i> Asker Çek</button>

      <h3>Askeri Destek Gönder</h3>
      <label class="muted">Oyuncu</label>
      <select id="support-recipient"></select>
      <label class="muted">Ülke</label>
      <select id="support-recipient-country"></select>
      <input type="number" id="support-soldiers" placeholder="Asker sayısı" min="1" />
      <button id="send-support-btn"><i class="fas fa-hands-holding"></i> Destek Gönder</button>
    </div>
  </div>

  <!-- ====== Building Popup ====== -->
  <div id="building-popup" class="modern-popup">
    <div class="popup-header" id="building-popup-header">
      <span>Bina Kurma</span>
      <button id="close-building-btn">&times;</button>
    </div>
    <div class="popup-content">
      <h3>Kışla</h3>
      <p class="muted">(1 Kışla = 300$ + 50 Varil + 120 Buğday)</p>
      <input type="number" id="barracks-quantity" placeholder="Adet" min="1" />
      <button id="buy-barracks-btn"><i class="fas fa-fort-awesome"></i> Kışla Kur</button>

      <h3>Fabrika</h3>
      <p class="muted">(1 Fabrika = 500$ + 130 Varil)</p>
      <input type="number" id="factory-quantity" placeholder="Adet" min="1" />
      <button id="build-factory-btn"><i class="fas fa-industry"></i> Fabrika Kur</button>

      <h3>Rafine</h3>
      <p class="muted">(1 Rafine = 800$ + 250 Varil)</p>
      <input type="number" id="refinery-quantity" placeholder="Adet" min="1" />
      <button id="build-refinery-btn"><i class="fas fa-oil-can"></i> Rafine Kur</button>

      <h3>Değirmen</h3>
      <p class="muted">(1 Değirmen = 200$ + 100 Varil)</p>
      <input type="number" id="grainmill-quantity" placeholder="Adet" min="1" />
      <button id="build-grainmill-btn"><i class="fas fa-wheat-awn"></i> Değirmen Kur</button>

      <h3>Kale</h3>
      <p class="muted">1 Kale = 1000$ + 1000 Varil + 1000 Buğday (Ülkede yalnızca 1 kale; saldıran askerlerin %5'i yok edilir)</p>
      <button id="build-castle-btn"><i class="fas fa-chess-rook"></i> Kale Kur</button>

      <h3>Kale Güçlendirme</h3>
      <p class="muted">Her güçlendirme +%5 (Maks %30). İlk güçlendirme: 1300$ + 1300 Varil + 1300 Buğday; her seferinde %30 artar.</p>
      <p class="muted">Mevcut/Sonraki Maliyet: <span id="castle-upgrade-cost-text">-</span></p>
      <button id="upgrade-castle-btn"><i class="fas fa-arrow-up"></i> Kale Güçlendir</button>
    </div>
  </div>

  <!-- ====== Resource Popup ====== -->
  <div id="resource-popup" class="modern-popup">
    <div class="popup-header" id="resource-popup-header">
      <span>Kaynak Gönder</span>
      <button id="close-resource-btn">&times;</button>
    </div>
    <div class="popup-content">
      <h3>Para</h3>
      <input type="number" id="money-to-send" placeholder="Miktar ($)" min="1"/>
      <select id="recipient-player"></select>
      <button id="send-money-btn"><i class="fas fa-hand-holding-dollar"></i> Gönder</button>

      <h3>Petrol</h3>
      <input type="number" id="petrol-to-send" placeholder="Varil" min="1"/>
      <select id="recipient-player-petrol"></select>
      <button id="send-petrol-btn"><i class="fas fa-gas-pump"></i> Gönder</button>

      <h3>Buğday</h3>
      <input type="number" id="wheat-to-send" placeholder="Buğday" min="1"/>
      <select id="recipient-player-wheat"></select>
      <button id="send-wheat-btn"><i class="fas fa-wheat-awn"></i> Gönder</button>
    </div>
  </div>

  <!-- ====== Pact Popup ====== -->
  <div id="pact-popup" class="modern-popup">
    <div id="pact-popup-header" class="popup-header">
      <span>Saldırmazlık Pakti</span>
      <button id="close-pact-btn">&times;</button>
    </div>
    <div class="popup-content">
      <h3>Yeni Pakt Teklifi</h3>
      <select id="pact-offer-recipient"></select>
      <input type="number" id="pact-duration" placeholder="Tur sayısı" min="1"/>
      <input type="number" id="pact-cost" placeholder="Tek seferlik para ($)" min="0"/>
      <button id="send-pact-offer-btn">Teklif Gönder</button>

      <h3>Gelen Teklifler</h3>
      <div id="pact-pending-offers"></div>

      <h3>Aktif Paktlar</h3>
      <div id="active-pacts-container"></div>
    </div>
  </div>

  <!-- ====== Market Popup ====== -->
  <div id="market-popup" class="modern-popup">
    <div class="popup-header" id="market-popup-header">
      <span>Ticaret Merkezi</span>
      <button id="close-market-btn">&times;</button>
    </div>
    <div class="popup-content">
      <h3>Yeni Teklif</h3>
      <label class="muted">Satılacak Ürün</label>
      <select id="trade-item-type">
        <option value="petrol">Petrol</option>
        <option value="wheat">Buğday</option>
      </select>
      <label class="muted">Miktar</label>
      <input type="number" id="trade-quantity" placeholder="Miktar" min="1"/>
      <label class="muted">Birim Fiyat ($)</label>
      <input type="number" id="trade-price" placeholder="Birim Fiyat" min="1"/>
      <label class="muted">Ambargo (Çoklu Seçim)</label>
      <select id="embargo-players" multiple style="min-height:70px; background:#fafafa; color:#111; border:1px solid var(--border); border-radius:10px;"></select>
      <button id="create-trade-offer-btn">Teklif Oluştur</button>

      <h3>Mevcut Teklifler</h3>
      <div id="trade-offers-list"></div>
    </div>
  </div>

  <!-- ====== Chat Popup ====== -->
  <div id="chat-popup" class="modern-popup chat-popup">
    <div class="chat-header" id="chat-popup-header">
      <span>Sohbet</span>
      <button id="close-chat-btn">&times;</button>
    </div>
    <div id="chat-messages" class="chat-messages"></div>
    <div class="chat-input-container">
      <input id="chat-input" type="text" placeholder="Mesajınızı yazın..." />
      <button id="send-chat-btn"><i class="fas fa-paper-plane"></i></button>
    </div>
    <div class="chat-private-container">
      <h4>Özel Mesaj</h4>
      <select id="private-message-recipient"></select>
      <input id="private-message-input" type="text" placeholder="Özel mesajınız..." />
      <button id="send-private-message-btn"><i class="fas fa-user-secret"></i> Gönder</button>
    </div>
  </div>

  <!-- ====== Flag Editor Popup ====== -->
  <div id="flag-editor-popup" class="modern-popup" style="right: 20px;">
    <div class="popup-header">
      <span>Bayrak Düzenleyici</span>
      <button id="close-flag-editor-btn">&times;</button>
    </div>
    <div class="popup-content">
      <canvas id="flag-canvas" width="440" height="260" style="border-radius:10px; background:#fff; border:1px solid var(--border)"></canvas>
      <div class="inline">
        <label class="muted">Renk</label>
        <input id="flag-color" type="color" value="#ff0000" style="width:48px; height:36px; padding:0; border:none"/>
        <label class="muted">Kalem</label>
        <input id="flag-brush-size" type="range" min="1" max="30" value="5" />
        <button id="flag-erase-btn" class="btn-ghost">Silgi</button>
        <button id="flag-clear-btn" class="btn-ghost">Temizle</button>
        <button id="save-flag-btn" class="btn"><i class="fas fa-save"></i> Kaydet</button>
      </div>
      <div class="muted">Kaydettiğin bayrak, fethettiğin ülkelerin dolgu deseni olarak haritada görünecek.</div>
    </div>
  </div>

  <!-- ====== Firebase (compat) ====== -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

  <!-- Leaflet Core -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <!-- Leaflet Pattern (bayrak dolgusu) -->
  <script src="https://unpkg.com/leaflet.pattern/leaflet.pattern.js"></script>

  <!-- Oyun Mantığı (senin JS dosyan) -->
  <!-- gameLogic.js içeriğini bir sonraki adımda düzeltilmiş haliyle ekleyeceğiz -->
  <script src="gameLogic.js"></script>
  <style>
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
</style>
<script>
  (function(){
    var els = document.querySelectorAll('input, select, textarea');
    els.forEach(function(el){
      var hasFor = el.id && document.querySelector('label[for="'+el.id+'"]');
      if(!hasFor && !el.getAttribute('aria-label')){
        var txt = el.getAttribute('placeholder') || el.name || el.id || 'Form alanı';
        el.setAttribute('aria-label', txt);
      }
    });
  })();
</script>

</body>
</html>

