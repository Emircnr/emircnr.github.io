<!DOCTYPE html>
<html lang="tr">
<head>
  <!-- Temel meta -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Sıkı ama çalışır CSP (inline script yok, modüler Firebase uyumlu) -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' https://www.gstatic.com https://www.googleapis.com https://unpkg.com https://cdnjs.cloudflare.com;
    style-src  'self' 'unsafe-inline' https://unpkg.com https://fonts.googleapis.com https://cdnjs.cloudflare.com;
    img-src    'self' data: blob: https://*;
    font-src   'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com data:;
    connect-src 'self' https://*.firebaseio.com wss://*.firebaseio.com https://www.googleapis.com https://securetoken.googleapis.com https://identitytoolkit.googleapis.com;
    frame-src  https://accounts.google.com https://*.firebaseapp.com;">
  <title>Global Conquest - Online</title>

  <!-- Fontlar -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Montserrat:wght@300;500;700&display=swap" rel="stylesheet" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin />

  <!-- Iconlar & Animasyonlar -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <style>
    :root{
      --bg1:#0e0f12; --bg2:#151726; --glass:rgba(0,0,0,.45);
      --text:#eeeeee; --muted:#c0c7cf;
      --brand:#64ffda; --brand2:#00c9ff; --warn:#f39c12; --danger:#ff4b4b;
      --card:#0f1320; --line:#2a2f3b;
      --shadow:0 12px 28px rgba(0,0,0,.7);
      --radius:16px;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:"Montserrat",sans-serif;
      color:var(--text);
      background: radial-gradient(circle at 18% -8%, #1a2030 0%, #0b0d12 60%, #000 100%);
      overflow:hidden;
    }
    h1,h2,h3{font-family:"Orbitron",sans-serif; letter-spacing:.6px; text-transform:uppercase}

    /* Bildirim */
    #notification-area{
      position:fixed; top:16px; right:16px; z-index:3000;
      display:flex; flex-direction:column; gap:10px; align-items:flex-end;
    }
    .notification-item{
      background:linear-gradient(135deg, rgba(255,255,255,.08), rgba(0,0,0,.55));
      border:1px solid rgba(255,255,255,.12);
      padding:10px 14px; border-radius:10px; box-shadow: var(--shadow);
      animation:fadeIn .25s ease both;
    }
    @keyframes fadeIn{from{opacity:0; transform:translateY(-4px)} to{opacity:1; transform:none}}

    /* AUTH */
    #auth-container{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      background: linear-gradient(135deg,#120a2a 0%,#171433 50%,#151515 100%);
      z-index:9;
    }
    .auth-box{
      width:min(460px,92vw);
      background:var(--glass); backdrop-filter: blur(8px);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      padding:26px;
      box-shadow: var(--shadow);
    }
    .auth-box h2{ text-align:center; margin-bottom:10px; color:var(--brand) }
    .auth-tabs{ display:flex; gap:8px; margin:10px 0 14px}
    .auth-tab{
      flex:1; padding:10px 12px; border-radius:10px; cursor:pointer;
      background:#0f1220; border:1px solid #262b3a; text-align:center;
      user-select:none;
    }
    .auth-tab.active{ border-color:var(--brand); box-shadow:0 0 0 2px rgba(100,255,218,.15) inset }
    .auth-form{ display:none; }
    .auth-form.active{ display:block; }
    .field{
      display:flex; flex-direction:column; gap:6px; margin-bottom:10px;
    }
    .field label{ font-size:12px; color:var(--muted) }
    .field input{
      background:#f7f8fb; color:#0c0f14; border:1px solid #d9dee6; border-radius:8px;
      padding:10px 12px; font-size:14px; outline:none;
    }
    .btn{
      width:100%; padding:12px; border:none; border-radius:10px; cursor:pointer;
      font-weight:700;
      background:linear-gradient(135deg, var(--brand), var(--brand2)); color:#0b0d12;
      box-shadow:0 6px 18px rgba(0,0,0,.5);
      transition:transform .15s ease;
      margin-top:6px;
    }
    .btn:hover{ transform:translateY(-1px) }
    .btn-danger{ background:linear-gradient(135deg,#ff6b6b,#ff2d2d); color:#fff }

    /* APP BAR */
    #top-info{
      position:fixed; top:10px; left:50%; transform:translateX(-50%);
      z-index:2; display:none; gap:10px; align-items:center;
      background:rgba(0,0,0,.58); border:1px solid rgba(255,255,255,.12);
      padding:8px 12px; border-radius:12px; box-shadow: var(--shadow);
    }
    #top-info p{ font-size:14px; color:#dfe6ee; margin:0 }
    #turn-timer{ color:var(--warn); font-weight:700; }

    /* MAP */
    #game-container{ display:none; height:100vh; width:100vw; position:relative; }
    #map{ position:absolute; inset:0; }

    /* Bottom action buttons */
    #bottom-icons{
      position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
      display:none; gap:16px; z-index:2;
    }
    .round-btn{
      width:52px;height:52px;border-radius:50%; border:none; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      background:linear-gradient(135deg, var(--brand), var(--brand2));
      color:#0b0d12; font-size:18px; box-shadow: var(--shadow);
    }

    /* Generic popup shell */
    .popup{
      position:fixed; bottom:86px; right:20px; width:min(460px,92vw); max-height:70vh;
      background:var(--glass); backdrop-filter: blur(10px);
      border:1px solid rgba(255,255,255,.12); border-radius:14px; display:none; flex-direction:column; z-index:3;
      box-shadow: var(--shadow);
    }
    .popup .head{
      padding:12px 14px; border-bottom:1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; justify-content:space-between; color:var(--brand)
    }
    .popup .body{ padding:14px; overflow:auto; color:#e9eef5; font-size:14px }
    .popup .head button{ background:transparent; border:none; color:#fff; font-size:22px; cursor:pointer }

    /* Players popup (left) */
    #players-popup{ left:20px; right:auto; }

    /* Responsive */
    @media (max-width: 768px){
      #top-info{ flex-direction:column; gap:6px }
      .round-btn{ width:46px; height:46px; font-size:16px }
    }
  </style>
</head>
<body>

  <!-- Bildirimler -->
  <div id="notification-area"></div>

  <!-- AUTH -->
  <div id="auth-container">
    <div class="auth-box">
      <h2>Global Conquest</h2>
      <div class="auth-tabs">
        <div id="login-tab" class="auth-tab active">Giriş</div>
        <div id="register-tab" class="auth-tab">Kayıt</div>
      </div>

      <!-- Giriş -->
      <div id="login-form" class="auth-form active" aria-labelledby="login-tab">
        <div class="field">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" autocomplete="email" placeholder="ornek@eposta.com" />
        </div>
        <div class="field">
          <label for="login-password">Şifre</label>
          <input type="password" id="login-password" autocomplete="current-password" placeholder="••••••••" />
        </div>
        <button id="login-btn" class="btn">Giriş Yap</button>
        <button id="google-btn" class="btn" style="margin-top:8px;"><i class="fab fa-google"></i>&nbsp; Google ile Giriş</button>
      </div>

      <!-- Kayıt -->
      <div id="register-form" class="auth-form" aria-labelledby="register-tab">
        <div class="field">
          <label for="register-display-name">Kullanıcı Adı</label>
          <input type="text" id="register-display-name" placeholder="Oyuncu" />
        </div>
        <div class="field">
          <label for="register-email">Email</label>
          <input type="email" id="register-email" autocomplete="email" placeholder="ornek@eposta.com" />
        </div>
        <div class="field">
          <label for="register-password">Şifre</label>
          <input type="password" id="register-password" autocomplete="new-password" placeholder="••••••••" />
        </div>
        <div class="field">
          <label for="register-confirm-password">Şifre Tekrar</label>
          <input type="password" id="register-confirm-password" autocomplete="new-password" placeholder="••••••••" />
        </div>
        <button id="register-btn" class="btn">Kayıt Ol</button>
      </div>
    </div>
  </div>

  <!-- TOP BAR (oyun içi) -->
  <div id="top-info" aria-live="polite">
    <p>Oda: <span id="display-room-name">-</span> | Tur: <span id="current-round">1</span> | Sıra: <span id="current-player">?</span></p>
    <button id="end-turn-btn" class="btn" style="padding:8px 12px; width:auto;"><i class="fas fa-forward"></i>&nbsp; Tur Sonu <span id="turn-timer">60s</span></button>
    <button id="logout-btn" class="btn btn-danger" style="padding:8px 12px; width:auto;">Çıkış</button>
  </div>

  <!-- OYUN EKRANI -->
  <div id="game-container">
    <div id="map" role="application" aria-label="Dünya Haritası"></div>
  </div>

  <!-- ALT AKSİYON BUTONLARI -->
  <div id="bottom-icons">
    <button id="open-players-btn" class="round-btn" title="Oyuncular"><i class="fas fa-users"></i></button>
    <button id="open-military-btn" class="round-btn" title="Asker İşlemleri"><i class="fas fa-shield-alt"></i></button>
    <button id="open-building-btn" class="round-btn" title="Bina Kurma"><i class="fas fa-building"></i></button>
    <button id="open-resource-btn" class="round-btn" title="Kaynak Gönder"><i class="fas fa-hand-holding-usd"></i></button>
    <button id="open-market-btn" class="round-btn" title="Ticaret Merkezi"><i class="fas fa-store"></i></button>
    <button id="open-pact-btn" class="round-btn" title="Saldırmazlık Pakti"><i class="fas fa-handshake"></i></button>
    <button id="open-chat-btn" class="round-btn" title="Sohbet"><i class="fas fa-comments"></i></button>
    <button id="open-profile-btn" class="round-btn" title="Profil"><i class="fas fa-user"></i></button>
    <button id="open-notifications-btn" class="round-btn" title="Bildirimler"><i class="fas fa-bell"></i></button>
  </div>

  <!-- POPUP KAPLARI (JS ile doldurulacak) -->
  <div id="players-popup" class="popup">
    <div class="head"><span>Oyuncular</span><button id="close-players-btn" aria-label="Kapat">&times;</button></div>
    <div id="players-info" class="body"></div>
  </div>

  <div id="military-popup" class="popup">
    <div class="head"><span>Asker İşlemleri</span><button id="close-military-btn" aria-label="Kapat">&times;</button></div>
    <div class="body">
      <!-- JS burada form/alanları oluşturacak veya istersen HTML’e sabit koyabilirsin -->
      <div class="field"><label for="attack-soldiers">Saldırı Askeri</label><input id="attack-soldiers" type="number" min="1" placeholder="Asker sayısı"></div>
      <button id="attack-btn" class="btn">Saldırı Yap</button>
      <hr style="border:none;border-top:1px solid rgba(255,255,255,.12); margin:14px 0">
      <div class="field"><label for="soldiers-to-buy">Asker Satın Al</label><input id="soldiers-to-buy" type="number" min="1" placeholder="Adet"></div>
      <button id="buy-soldiers-btn" class="btn">Satın Al</button>
      <hr style="border:none;border-top:1px solid rgba(255,255,255,.12); margin:14px 0">
      <div class="field"><label for="pull-soldiers-count">Asker Çek</label><input id="pull-soldiers-count" type="number" min="1" placeholder="Asker sayısı"></div>
      <button id="pull-soldiers-btn" class="btn">Asker Çek</button>
      <hr style="border:none;border-top:1px solid rgba(255,255,255,.12); margin:14px 0">
      <div class="field"><label>Askeri Destek</label></div>
      <div class="field"><label for="support-recipient">Oyuncu</label><select id="support-recipient"></select></div>
      <div class="field"><label for="support-recipient-country">Ülke</label><select id="support-recipient-country"></select></div>
      <div class="field"><label for="support-soldiers">Asker</label><input id="support-soldiers" type="number" min="1" placeholder="Asker sayısı"></div>
      <button id="send-support-btn" class="btn">Destek Gönder</button>
    </div>
  </div>

  <div id="building-popup" class="popup">
    <div class="head"><span>Bina Kurma</span><button id="close-building-btn" aria-label="Kapat">&times;</button></div>
    <div class="body">
      <div class="field"><label for="barracks-quantity">Kışla (300$ + 50V + 120B)</label><input id="barracks-quantity" type="number" min="1" placeholder="Adet"></div>
      <button id="buy-barracks-btn" class="btn">Kışla Kur</button>
      <div class="field" style="margin-top:12px;"><label for="factory-quantity">Fabrika (500$ + 130V)</label><input id="factory-quantity" type="number" min="1" placeholder="Adet"></div>
      <button id="build-factory-btn" class="btn">Fabrika Kur</button>
      <div class="field" style="margin-top:12px;"><label for="refinery-quantity">Rafine (800$ + 250V)</label><input id="refinery-quantity" type="number" min="1" placeholder="Adet"></div>
      <button id="build-refinery-btn" class="btn">Rafine Kur</button>
      <div class="field" style="margin-top:12px;"><label for="grainmill-quantity">Değirmen (200$ + 100V)</label><input id="grainmill-quantity" type="number" min="1" placeholder="Adet"></div>
      <button id="build-grainmill-btn" class="btn">Değirmen Kur</button>
      <hr style="border:none;border-top:1px solid rgba(255,255,255,.12); margin:14px 0">
      <p style="margin-bottom:6px">Kale (1000$ + 1000V + 1000B) – Ülkede yalnızca 1 adet.</p>
      <button id="build-castle-btn" class="btn">Kale Kur</button>
      <p style="margin:10px 0 4px">Kale Güçlendirme: +%5/level (Max %30)</p>
      <p>Fiyat: <span id="castle-upgrade-cost-text">-</span></p>
      <button id="upgrade-castle-btn" class="btn" style="margin-top:6px">Kale Güçlendir</button>
    </div>
  </div>

  <div id="resource-popup" class="popup">
    <div class="head"><span>Kaynak Gönder</span><button id="close-resource-btn" aria-label="Kapat">&times;</button></div>
    <div class="body">
      <div class="field"><label for="money-to-send">Para ($)</label><input id="money-to-send" type="number" min="1" placeholder="Miktar"></div>
      <div class="field"><label for="recipient-player">Alıcı</label><select id="recipient-player"></select></div>
      <button id="send-money-btn" class="btn">Para Gönder</button>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,.12); margin:14px 0">

      <div class="field"><label for="petrol-to-send">Petrol (Varil)</label><input id="petrol-to-send" type="number" min="1" placeholder="Varil"></div>
      <div class="field"><label for="recipient-player-petrol">Alıcı</label><select id="recipient-player-petrol"></select></div>
      <button id="send-petrol-btn" class="btn">Petrol Gönder</button>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,.12); margin:14px 0">

      <div class="field"><label for="wheat-to-send">Buğday</label><input id="wheat-to-send" type="number" min="1" placeholder="Buğday"></div>
      <div class="field"><label for="recipient-player-wheat">Alıcı</label><select id="recipient-player-wheat"></select></div>
      <button id="send-wheat-btn" class="btn">Buğday Gönder</button>
    </div>
  </div>

  <div id="market-popup" class="popup">
    <div class="head"><span>Ticaret Merkezi</span><button id="close-market-btn" aria-label="Kapat">&times;</button></div>
    <div class="body">
      <div class="field"><label for="trade-item-type">Ürün</label>
        <select id="trade-item-type">
          <option value="petrol">Petrol</option>
          <option value="wheat">Buğday</option>
        </select>
      </div>
      <div class="field"><label for="trade-quantity">Miktar</label><input id="trade-quantity" type="number" min="1" placeholder="Miktar"></div>
      <div class="field"><label for="trade-price">Birim Fiyat ($)</label><input id="trade-price" type="number" min="1" placeholder="Fiyat"></div>
      <div class="field"><label for="embargo-players">Ambargo (Çoklu seç)</label><select id="embargo-players" multiple style="min-height:84px;"></select></div>
      <button id="create-trade-offer-btn" class="btn">Teklif Oluştur</button>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,.12); margin:14px 0">

      <div id="trade-offers-list"></div>
    </div>
  </div>

  <div id="pact-popup" class="popup">
    <div class="head"><span>Saldırmazlık Pakti</span><button id="close-pact-btn" aria-label="Kapat">&times;</button></div>
    <div class="body">
      <div class="field"><label for="pact-offer-recipient">Oyuncu</label><select id="pact-offer-recipient"></select></div>
      <div class="field"><label for="pact-duration">Tur</label><input id="pact-duration" type="number" min="1" placeholder="Tur sayısı"></div>
      <div class="field"><label for="pact-cost">Tek seferlik para ($)</label><input id="pact-cost" type="number" min="0" placeholder="Para"></div>
      <button id="send-pact-offer-btn" class="btn">Teklif Gönder</button>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,.12); margin:14px 0">

      <h3 style="margin-bottom:8px;font-size:16px;color:#ffd54f;">Gelen Teklifler</h3>
      <div id="pact-pending-offers"></div>

      <h3 style="margin:12px 0 8px;font-size:16px;color:#ffd54f;">Aktif Paktlar</h3>
      <div id="active-pacts-container"></div>
    </div>
  </div>

  <div id="chat-popup" class="popup">
    <div class="head"><span>Sohbet</span><button id="close-chat-btn" aria-label="Kapat">&times;</button></div>
    <div class="body" style="display:flex; flex-direction:column; gap:10px;">
      <div id="chat-messages" style="flex:1; min-height:180px; background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.08); border-radius:10px; padding:10px; overflow:auto;"></div>
      <div style="display:flex; gap:8px;">
        <input type="text" id="chat-input" placeholder="Mesaj yaz..." style="flex:1; padding:10px; border-radius:8px; border:1px solid #d9dee6; color:#0c0f14;">
        <button id="send-chat-btn" class="btn" style="width:auto; padding:10px 14px;">Gönder</button>
      </div>
      <div style="border-top:1px solid rgba(255,255,255,.12); padding-top:10px;">
        <h3 style="font-size:14px; margin-bottom:8px; color:#ffd54f;">Özel Mesaj</h3>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <select id="private-message-recipient" style="flex:1; padding:10px; border-radius:8px; border:1px solid #d9dee6; color:#0c0f14;"></select>
          <input type="text" id="private-message-input" placeholder="Özel mesaj..." style="flex:2; padding:10px; border-radius:8px; border:1px solid #d9dee6; color:#0c0f14;">
          <button id="send-private-message-btn" class="btn" style="width:auto; padding:10px 14px;">Gönder</button>
        </div>
      </div>
    </div>
  </div>

  <div id="profile-popup" class="popup" style="right:20px;">
    <div class="head"><span>Profil & Arkadaşlar</span><button id="close-profile-btn" aria-label="Kapat">&times;</button></div>
    <div class="body">
      <h3 style="font-size:16px; color:#ffd54f; margin-bottom:6px;">Arkadaşlar</h3>
      <div id="friend-list" style="margin-bottom:10px;"></div>
      <h3 style="font-size:16px; color:#ffd54f; margin:10px 0 6px;">Gelen İstekler</h3>
      <div id="friend-request-list" style="margin-bottom:10px;"></div>
      <h3 style="font-size:16px; color:#ffd54f; margin:10px 0 6px;">Arkadaş Ekle</h3>
      <div style="display:flex; gap:8px;">
        <input type="text" id="add-friend-username" placeholder="Kullanıcı Adı" style="flex:1; padding:10px; border-radius:8px; border:1px solid #d9dee6; color:#0c0f14;">
        <button id="send-friend-request-btn" class="btn" style="width:auto;">İstek Gönder</button>
      </div>
      <h3 style="font-size:16px; color:#ffd54f; margin:12px 0 6px;">Oda Davetleri</h3>
      <div id="room-invite-list"></div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin></script>

  <!-- Oyun Mantığı (modüler Firebase) -->
  <script type="module" src="gamelogic.js"></script>
</body>
</html>
